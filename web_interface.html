<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent with RAG System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="40%"><stop offset="0%" stop-color="white" stop-opacity="0.3"/><stop offset="100%" stop-color="white" stop-opacity="0"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>');
            opacity: 0.3;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            padding: 30px;
            min-height: 600px;
        }

        .sidebar {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .sidebar h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar h3::before {
            content: 'ðŸ“š';
            font-size: 1.2em;
        }

        .document-list {
            list-style: none;
        }

        .document-item {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4facfe;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .document-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .document-item .title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .document-item .size {
            font-size: 0.9em;
            color: #6c757d;
        }

        .chat-area {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-messages {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
            overflow-y: auto;
            max-height: 500px;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .message-content {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 15px;
            max-width: 70%;
            word-wrap: break-word;
            border: 1px solid #e9ecef;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .message-meta {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 5px;
        }

        .message.user .message-meta {
            color: rgba(255, 255, 255, 0.8);
        }

        .input-area {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .input-container {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1em;
            resize: none;
            outline: none;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .message-input:focus {
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .send-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .sources {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px 15px;
            margin-top: 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .sources-title {
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 5px;
        }

        .confidence-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .input-area {
                flex-direction: column;
            }
            
            .send-button {
                align-self: flex-end;
            }
        }

        .welcome-message {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px 20px;
        }

        .welcome-message h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .welcome-message p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .example-questions {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }

        .example-questions h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .example-question {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .example-question:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ¤– AI Agent with RAG System</h1>
            <p>Intelligent Document Search & Question Answering</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h3>ðŸ“š Available Documents</h3>
                <ul class="document-list" id="documentList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>Loading documents...</div>
                    </div>
                </ul>

                <div class="example-questions">
                    <h4>ðŸ’¡ Try these questions:</h4>
                    <div class="example-question" onclick="sendExampleQuestion('What is the remote work policy?')">
                        What is the remote work policy?
                    </div>
                    <div class="example-question" onclick="sendExampleQuestion('Tell me about employee benefits')">
                        Tell me about employee benefits
                    </div>
                    <div class="example-question" onclick="sendExampleQuestion('What are the security requirements?')">
                        What are the security requirements?
                    </div>
                    <div class="example-question" onclick="sendExampleQuestion('How does CloudSync work?')">
                        How does CloudSync work?
                    </div>
                </div>
            </div>

            <div class="chat-area">
                <div class="error-message" id="errorMessage"></div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="welcome-message">
                        <h3>ðŸ‘‹ Welcome to the AI Agent!</h3>
                        <p>I'm here to help you find information from your documents.</p>
                        <p>Ask me anything about company policies, benefits, security, or technical documentation.</p>
                        <p>Type your question below or try one of the example questions.</p>
                    </div>
                </div>

                <div class="input-area">
                    <div class="input-container">
                        <textarea 
                            class="message-input" 
                            id="messageInput" 
                            placeholder="Ask me anything about the documents..."
                            rows="1"
                        ></textarea>
                    </div>
                    <button class="send-button" id="sendButton" onclick="sendMessage()">
                        âž¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let sessionId = null;
        let isProcessing = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadDocuments();
            setupEventListeners();
            generateSessionId();
        });

        // Generate unique session ID
        function generateSessionId() {
            sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Setup event listeners
        function setupEventListeners() {
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');

            // Handle Enter key (Shift+Enter for new line)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Auto-resize textarea
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }

        // Load documents from the server
        async function loadDocuments() {
            try {
                // For now, we'll simulate the document list
                // In a real implementation, this would call the API
                const documents = [
                    { title: 'Company Remote Work Policy', size: 2847 },
                    { title: 'Employee Benefits Handbook', size: 3251 },
                    { title: 'IT Security Policy', size: 2184 },
                    { title: 'Product FAQ CloudSync', size: 1953 },
                    { title: 'Technical API Guide', size: 2431 }
                ];

                displayDocuments(documents);
            } catch (error) {
                console.error('Error loading documents:', error);
                showError('Failed to load documents');
            }
        }

        // Display documents in the sidebar
        function displayDocuments(documents) {
            const documentList = document.getElementById('documentList');
            documentList.innerHTML = '';

            documents.forEach(doc => {
                const listItem = document.createElement('li');
                listItem.className = 'document-item';
                listItem.innerHTML = `
                    <div class="title">${doc.title}</div>
                    <div class="size">${formatFileSize(doc.size)}</div>
                `;
                documentList.appendChild(listItem);
            });
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // Send message to the AI agent
        async function sendMessage() {
            if (isProcessing) return;

            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();

            if (!message) return;

            // Add user message to chat
            addMessageToChat(message, 'user');

            // Clear input and disable send button
            messageInput.value = '';
            messageInput.style.height = 'auto';
            setProcessingState(true);

            try {
                // For now, we'll use the simple demo approach
                // In a real implementation, this would call the FastAPI backend
                const response = await processQueryWithSimpleDemo(message);
                
                // Add AI response to chat
                addMessageToChat(response.answer, 'assistant', {
                    sources: response.sources,
                    confidence: response.confidence
                });

            } catch (error) {
                console.error('Error processing query:', error);
                showError('Failed to process your question. Please try again.');
                
                // Fallback response
                const fallbackResponse = "I apologize, but I'm having trouble processing your question right now. Please try again or ask a different question.";
                addMessageToChat(fallbackResponse, 'assistant');
            } finally {
                setProcessingState(false);
            }
        }

        // Process query using simple demo approach
        async function processQueryWithSimpleDemo(query) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));

            // Simple keyword-based search simulation
            const queryLower = query.toLowerCase();
            const documents = {
                'company_remote_work_policy.txt': {
                    title: 'Company Remote Work Policy',
                    content: 'Remote work policy allows employees to work from home up to 3 days per week. Full remote work is available for senior employees with manager approval.',
                    keywords: ['remote', 'work', 'home', 'policy', 'employee']
                },
                'employee_benefits_handbook.txt': {
                    title: 'Employee Benefits Handbook',
                    content: 'Employees receive health insurance, dental coverage, 401k matching, paid time off, and professional development opportunities.',
                    keywords: ['benefits', 'health', 'insurance', '401k', 'pto']
                },
                'it_security_policy.txt': {
                    title: 'IT Security Policy',
                    content: 'All employees must use strong passwords, enable two-factor authentication, and complete annual security training.',
                    keywords: ['security', 'password', 'authentication', 'training', 'policy']
                },
                'product_faq_cloudsync.txt': {
                    title: 'Product FAQ CloudSync',
                    content: 'CloudSync automatically backs up your files to secure cloud storage. It supports real-time synchronization across devices.',
                    keywords: ['cloudsync', 'backup', 'cloud', 'synchronization', 'files']
                },
                'technical_api_guide.txt': {
                    title: 'Technical API Guide',
                    content: 'Our API provides RESTful endpoints for data access, supports JSON format, and requires authentication tokens.',
                    keywords: ['api', 'restful', 'json', 'authentication', 'endpoints']
                }
            };

            // Find relevant documents
            const relevantDocs = [];
            Object.entries(documents).forEach(([filename, doc]) => {
                const score = doc.keywords.filter(keyword => 
                    queryLower.includes(keyword) || keyword.includes(queryLower.split(' ')[0])
                ).length;
                
                if (score > 0) {
                    relevantDocs.push({
                        filename,
                        title: doc.title,
                        content: doc.content,
                        score
                    });
                }
            });

            // Sort by relevance and take top results
            relevantDocs.sort((a, b) => b.score - a.score);
            const topDocs = relevantDocs.slice(0, 3);

            // Generate response
            let answer;
            let sources = [];
            let confidence = 0.3;

            if (topDocs.length > 0) {
                sources = topDocs.map(doc => doc.filename);
                confidence = Math.min(0.9, 0.5 + topDocs.length * 0.15);

                const greeting = getGreeting();
                const responses = topDocs.map((doc, index) => 
                    `${index + 1}. From ${doc.title}: ${doc.content}`
                ).join('\n\n');

                answer = `${greeting} Based on the available documents, here's what I found:\n\n${responses}\n\nI hope this information is helpful! If you need more specific details, feel free to ask.`;
            } else {
                answer = "I couldn't find specific information related to your question in the available documents. Please try rephrasing your question or ask about topics like remote work policies, employee benefits, security requirements, CloudSync functionality, or API documentation.";
            }

            return {
                answer,
                sources,
                session_id: sessionId,
                confidence,
                timestamp: new Date().toISOString()
            };
        }

        // Get greeting based on time
        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return "Good morning!";
            if (hour < 17) return "Good afternoon!";
            return "Good evening!";
        }

        // Send example question
        function sendExampleQuestion(question) {
            const messageInput = document.getElementById('messageInput');
            messageInput.value = question;
            messageInput.focus();
            sendMessage();
        }

        // Add message to chat
        function addMessageToChat(content, sender, metadata = {}) {
            const chatMessages = document.getElementById('chatMessages');
            
            // Remove welcome message if it exists
            const welcomeMessage = chatMessages.querySelector('.welcome-message');
            if (welcomeMessage) {
                welcomeMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = formatMessageContent(content);

            // Add metadata if available
            if (metadata.sources && metadata.sources.length > 0) {
                const sourcesDiv = document.createElement('div');
                sourcesDiv.className = 'sources';
                sourcesDiv.innerHTML = `
                    <div class="sources-title">ðŸ“š Sources:</div>
                    <div>${metadata.sources.join(', ')}</div>
                `;
                contentDiv.appendChild(sourcesDiv);
            }

            if (metadata.confidence) {
                const confidenceSpan = document.createElement('span');
                confidenceSpan.className = 'confidence-badge';
                confidenceSpan.textContent = `${(metadata.confidence * 100).toFixed(0)}% confident`;
                contentDiv.appendChild(confidenceSpan);
            }

            const metaDiv = document.createElement('div');
            metaDiv.className = 'message-meta';
            metaDiv.textContent = new Date().toLocaleTimeString();

            contentDiv.appendChild(metaDiv);

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);

            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Format message content (handle line breaks)
        function formatMessageContent(content) {
            return content.replace(/\n/g, '<br>');
        }

        // Set processing state
        function setProcessingState(processing) {
            isProcessing = processing;
            const sendButton = document.getElementById('sendButton');
            const messageInput = document.getElementById('messageInput');

            if (processing) {
                sendButton.disabled = true;
                messageInput.disabled = true;
                
                // Show loading indicator
                const chatMessages = document.getElementById('chatMessages');
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'message assistant';
                loadingDiv.id = 'loadingMessage';
                loadingDiv.innerHTML = `
                    <div class="message-avatar">ðŸ¤–</div>
                    <div class="message-content">
                        <div class="loading active">
                            <div class="spinner"></div>
                            <div>Thinking...</div>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(loadingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            } else {
                sendButton.disabled = false;
                messageInput.disabled = false;
                messageInput.focus();
                
                // Remove loading indicator
                const loadingMessage = document.getElementById('loadingMessage');
                if (loadingMessage) {
                    loadingMessage.remove();
                }
            }
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        // Clear error message
        function clearError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.classList.remove('show');
        }
    </script>
</body>
</html>